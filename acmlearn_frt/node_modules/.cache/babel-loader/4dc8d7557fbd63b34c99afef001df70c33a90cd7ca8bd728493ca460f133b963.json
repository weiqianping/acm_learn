{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { useToast } from 'vue-toastification';\nimport { useRouter } from 'vue-router';\nimport { useStore } from '@/store';\nimport api from '@/services/api';\nexport default {\n  name: 'LoginRegister',\n  data() {\n    return {\n      isLogin: true,\n      email: '',\n      password: '',\n      confirmPassword: '',\n      username: '',\n      code: '',\n      isCountingDown: false,\n      countdown: 60,\n      errorMessage: ''\n    };\n  },\n  setup() {\n    const toast = useToast();\n    const router = useRouter();\n    const {\n      login\n    } = useStore();\n    return {\n      toast,\n      router,\n      login\n    };\n  },\n  methods: {\n    async handleSubmit() {\n      this.errorMessage = '';\n      if (this.isLogin) {\n        await this.handleLogin();\n      } else {\n        await this.register();\n      }\n    },\n    async handleLogin() {\n      try {\n        const response = await api.login(this.email, this.username, this.password);\n        console.log('登录成功:', response);\n        this.toast.success('登录成功');\n        // 保存 Token 和用户信息\n        localStorage.setItem('token', response.token);\n\n        //localStorage.setItem('user', JSON.stringify(response.user));\n        localStorage.setItem('user', response.user);\n        // 更新全局状态\n        this.login(response.user);\n      } catch (error) {\n        this.errorMessage = error.response ? error.response.data : error.message;\n      }\n    },\n    async register() {\n      // 注册逻辑\n      if (this.password !== this.confirmPassword) {\n        this.errorMessage = '密码和确认密码不一致';\n        return;\n      }\n      try {\n        //console.log(this.verificationCode)\n        const response = await api.register(this.email, this.username, this.password, this.code);\n        console.log('注册成功:', response);\n        this.toast.success('注册成功');\n        this.router.push('/login');\n      } catch (error) {\n        this.errorMessage = error.response ? error.response.data : error.message;\n      }\n    },\n    async sendVerificationCode() {\n      try {\n        await api.sendVerificationCode(this.email);\n        this.toast.success('验证码发送成功');\n        this.startCountdown();\n      } catch (error) {\n        this.toast.error('发送验证码失败: ' + (error.response ? error.response.data : error.message));\n      }\n    },\n    startCountdown() {\n      this.isCountingDown = true;\n      const interval = setInterval(() => {\n        this.countdown -= 1;\n        if (this.countdown <= 0) {\n          clearInterval(interval);\n          this.isCountingDown = false;\n          this.countdown = 60;\n        }\n      }, 1000);\n    },\n    toggleView() {\n      this.isLogin = !this.isLogin;\n      this.email = '';\n      this.password = '';\n      this.confirmPassword = '';\n      this.username = '';\n      this.verificationCode = '';\n      this.errorMessage = '';\n    }\n  }\n};","map":{"version":3,"names":["useToast","useRouter","useStore","api","name","data","isLogin","email","password","confirmPassword","username","code","isCountingDown","countdown","errorMessage","setup","toast","router","login","methods","handleSubmit","handleLogin","register","response","console","log","success","localStorage","setItem","token","user","error","message","push","sendVerificationCode","startCountdown","interval","setInterval","clearInterval","toggleView","verificationCode"],"sources":["E:\\acm_learn\\acmlearn_frt\\src\\components\\LoginRegister.vue"],"sourcesContent":["<template>\r\n    <div class=\"login-register\">\r\n      <h1>{{ isLogin ? '登录' : '注册' }}</h1>\r\n      <div v-if=\"errorMessage\" class=\"error-message\">{{ errorMessage }}</div>\r\n      <form @submit.prevent=\"handleSubmit\">\r\n        <div class=\"email-row\">\r\n          <input type=\"email\" v-model=\"email\" placeholder=\"邮箱\" required />\r\n          <button type=\"button\" @click=\"sendVerificationCode\" :disabled=\"isCountingDown\" v-if=\"!isLogin\">\r\n            {{ isCountingDown ? `${countdown}秒后重试` : '发送验证码' }}\r\n          </button>\r\n        </div>\r\n        <div v-if=\"!isLogin\">\r\n          <input type=\"text\" v-model=\"code\" placeholder=\"验证码\" required />\r\n          <input type=\"text\" v-model=\"username\" placeholder=\"用户名\" required />\r\n          <input type=\"password\" v-model=\"password\" placeholder=\"密码\" required />\r\n          <input type=\"password\" v-model=\"confirmPassword\" placeholder=\"确认密码\" required />\r\n        </div>\r\n        <div v-else>\r\n          <input type=\"text\" v-model=\"username\" placeholder=\"用户名\" required />\r\n          <input type=\"password\" v-model=\"password\" placeholder=\"密码\" required />\r\n        </div>\r\n        <button type=\"submit\">{{ isLogin ? '登录' : '注册' }}</button>\r\n      </form>\r\n      <button @click=\"toggleView\">{{ isLogin ? '切换到注册' : '切换到登录' }}</button>\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  import { useToast } from 'vue-toastification'\r\n  import { useRouter } from 'vue-router'\r\n  import { useStore } from '@/store'\r\n  import api from '@/services/api';\r\n  \r\n  \r\n  export default {\r\n    name: 'LoginRegister',\r\n    data() {\r\n      return {\r\n        isLogin: true,\r\n        email: '',\r\n        password: '',\r\n        confirmPassword: '',\r\n        username: '',\r\n        code: '',\r\n        isCountingDown: false,\r\n        countdown: 60,\r\n        errorMessage: ''\r\n      }\r\n    },\r\n    setup() {\r\n      const toast = useToast()\r\n      const router = useRouter()\r\n      const { login } = useStore()\r\n      return { toast, router, login }\r\n    },\r\n    methods: {\r\n      async handleSubmit() {\r\n        this.errorMessage = ''\r\n        if (this.isLogin) {\r\n          await this.handleLogin()\r\n        } else {\r\n          await this.register()\r\n        }\r\n      },\r\n      async handleLogin() {\r\n        try {\r\n          const response = await api.login(this.email, this.username, this.password);\r\n          console.log('登录成功:', response);\r\n          this.toast.success('登录成功');\r\n          // 保存 Token 和用户信息\r\n          localStorage.setItem('token', response.token);\r\n          \r\n          //localStorage.setItem('user', JSON.stringify(response.user));\r\n          localStorage.setItem('user', response.user);\r\n          // 更新全局状态\r\n          this.login(response.user);\r\n        } catch (error) {\r\n          this.errorMessage = error.response ? error.response.data : error.message;\r\n        }\r\n      },\r\n      async register() {\r\n        // 注册逻辑\r\n        if (this.password !== this.confirmPassword) {\r\n          this.errorMessage = '密码和确认密码不一致';\r\n          return;\r\n        }\r\n        try {\r\n          //console.log(this.verificationCode)\r\n          const response = await api.register(this.email, this.username, this.password, this.code);\r\n          console.log('注册成功:', response);\r\n          this.toast.success('注册成功');\r\n          this.router.push('/login');\r\n        } catch (error) {\r\n          this.errorMessage = error.response ? error.response.data : error.message;\r\n        }\r\n      },\r\n      async sendVerificationCode() {\r\n        try {\r\n          await api.sendVerificationCode(this.email);\r\n          this.toast.success('验证码发送成功');\r\n          this.startCountdown();\r\n        } catch (error) {\r\n          this.toast.error('发送验证码失败: ' + (error.response ? error.response.data : error.message));\r\n        }\r\n      },\r\n      startCountdown() {\r\n        this.isCountingDown = true;\r\n        const interval = setInterval(() => {\r\n          this.countdown -= 1;\r\n          if (this.countdown <= 0) {\r\n            clearInterval(interval);\r\n            this.isCountingDown = false;\r\n            this.countdown = 60;\r\n          }\r\n        }, 1000);\r\n      },\r\n      toggleView() {\r\n        this.isLogin = !this.isLogin;\r\n        this.email = '';\r\n        this.password = '';\r\n        this.confirmPassword = '';\r\n        this.username = '';\r\n        this.verificationCode = '';\r\n        this.errorMessage = '';\r\n      }\r\n    }\r\n  }\r\n  </script>\r\n  \r\n  <style scoped>\r\n  .login-register {\r\n    padding: 2rem;\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n  }\r\n  \r\n  .login-register h1 {\r\n    font-size: 2rem;\r\n    margin-bottom: 1rem;\r\n  }\r\n  \r\n  .login-register form {\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 1rem;\r\n    width: 100%;\r\n    max-width: 300px;\r\n  }\r\n  \r\n  .login-register input {\r\n    padding: 0.5rem;\r\n    border: 1px solid #ccc;\r\n    border-radius: 4px;\r\n    width: 100%;\r\n  }\r\n  \r\n  .email-row {\r\n    display: flex;\r\n    gap: 0.5rem;\r\n  }\r\n  \r\n  .email-row input {\r\n    flex: 1;\r\n  }\r\n  \r\n  .email-row button {\r\n    padding: 0.5rem;\r\n    background-color: #42b983;\r\n    color: white;\r\n    border: none;\r\n    border-radius: 4px;\r\n    cursor: pointer;\r\n    transition: background-color 0.3s;\r\n  }\r\n  \r\n  .email-row button:disabled {\r\n    background-color: #ccc;\r\n    cursor: not-allowed;\r\n  }\r\n  \r\n  .login-register button {\r\n    padding: 0.5rem;\r\n    background-color: #42b983;\r\n    color: white;\r\n    border: none;\r\n    border-radius: 4px;\r\n    cursor: pointer;\r\n    transition: background-color 0.3s;\r\n  }\r\n  \r\n  .login-register button:hover {\r\n    background-color: #38a169;\r\n  }\r\n  \r\n  .error-message {\r\n    color: red;\r\n    margin-bottom: 1rem;\r\n  }\r\n  </style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}